"use strict";(self.webpackChunkfooter=self.webpackChunkfooter||[]).push([[318],{1318:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var s=a(6213),r=a(5043),l=a(3986),n=a(579);function i(e){const[t,a]=(0,r.useState)({}),[i,o]=(0,r.useState)({billdate:"",billno:""});let d="https://backend-mqr6.onrender.com";const[u,c]=(0,r.useState)(""),m=e=>{o({...i,[e.target.name]:[e.target.value]})},[p,x]=(0,r.useState)(!1),h=()=>{x(!0)},[b,g]=(0,r.useState)(0),[N,v]=(0,r.useState)({}),f=(e,t)=>{const a=[...V],s=N[t];if(!a[P].serialNumbers.includes(s)){a[P].serialNumbers.length<=a[P].quantity&&(a[P].serialNumbers.push(s),B(a),v({...N,[t]:""}));const e=a[t].serialNumbers.length;g(e),a[t].quantity==e?G(!1):G(!0)}},[y,j]=(0,r.useState)([]),[w,q]=(0,r.useState)([]),[C,k]=(0,r.useState)(""),[S,$]=(0,r.useState)(""),[L,E]=(0,r.useState)([]),[_,A]=(0,r.useState)([]),[I,F]=(0,r.useState)([]),[P,D]=(0,r.useState)([]),[z,G]=(0,r.useState)(!1),[O,T]=(0,r.useState)("");(0,r.useEffect)((()=>{(async()=>{try{let e=localStorage.getItem("token");const t=await s.A.get(`${d}/api/product/productnames`,{method:"GET",headers:{authtoken:e}});j(t.data)}catch(e){console.error("Error fetching products:",e)}})(),(async()=>{try{let e=localStorage.getItem("token");const t=await s.A.get(`${d}/api/supplier/suppliernames`,{method:"GET",headers:{authtoken:e}});q(t.data)}catch(e){console.error("Error fetching products:",e)}})()}),[]),(0,r.useEffect)((()=>{E(C?y.productNames.filter((e=>e.toLowerCase().includes(C.toLowerCase()))):[])}),[C,y]),(0,r.useEffect)((()=>{A(S?w.supplierNames.filter((e=>e.toLowerCase().includes(S.toLowerCase()))):[])}),[S,w]);const[V,B]=(0,r.useState)([{quantity:"",amount:"",productname:"",serialNumbers:[],serialInput:"",rateper:""}]),R=async(e,t)=>{const a=[...V],{name:s,value:r}=null===t||void 0===t?void 0:t.target;let l={...a[e]};if("rateper"===s){const t=l.quantity*r;a[e].amount=t}if("amount"===s){const t=r/l.quantity;a[e].rateper=t,"NO"!==O&&(a[e].quantity==b?G(!1):G(!0))}else G(!1);if(0!==l.quantity&&"quantity"!==s?"NO"!==O&&(a[e].quantity==b?G(!1):G(!0)):G(!1),"serialInput"===s)a[e][s]=r;else if("supplier"===s){if(a[e][s]=r,!w.supplierNames.some((e=>e.toLowerCase().includes(r.toLowerCase()))))return;a[e][t.target.name]=t.target.value,A(r?w.supplierNames.filter((e=>e.toLowerCase().includes(r.toLowerCase()))):[])}else if("productname"===s){if(a[e][s]=r,!y.productNames.some((e=>e.toLowerCase().includes(r.toLowerCase()))))return;a[e][t.target.name]=t.target.value,E(r?y.productNames.filter((e=>e.toLowerCase().includes(r.toLowerCase()))):[])}else a[e][s]=r;B(a)};return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:" ",children:[(0,n.jsx)("div",{className:"App",children:(0,n.jsx)(l.A,{show:p,onClose:()=>{x(!1)},message:u})}),(0,n.jsxs)("div",{className:"flex gap-3 mt-2",children:[(0,n.jsxs)("div",{className:"w-[50%]",children:[(0,n.jsx)("input",{type:"text",onChange:e=>{const t=e.target.value;$(t),w.supplierNames.some((e=>e.toLowerCase().includes(t.toLowerCase())))?$(t):$(S)},value:S,name:"supplier",placeholder:"supplier name",className:" px-3 py-1 border-black border-[2px] w-[100%] rounded-md  "}),t.supplierquery&&(0,n.jsx)("span",{className:"text-red-500",children:t.supplierquery}),_&&(0,n.jsx)("div",{className:"absolute bg-gray-300 px-3 z-20  rounded-md",children:(0,n.jsx)("div",{className:"suggestions ",children:_.map(((e,t)=>(0,n.jsx)("div",{className:"suggestion  cursor-pointer",onClick:()=>(e=>{$(e),A([])})(e),children:e},t)))})})]}),(0,n.jsxs)("div",{className:"w-[25%] flex flex-col",children:[(0,n.jsx)("input",{type:"text",onChange:m,value:i.billno,name:"billno",placeholder:"billno",className:" px-3 py-1 border-black border-[2px]  rounded-md"}),t.billno&&(0,n.jsx)("span",{className:"text-red-500",children:t.billno})]}),(0,n.jsxs)("div",{className:"w-[25%] flex flex-col",children:[(0,n.jsx)("input",{type:"date",onChange:m,value:i.billdate,name:"billdate",placeholder:"bill date",className:" px-3 py-1 border-black border-[2px]   rounded-md"}),t.billdate&&(0,n.jsx)("span",{className:"text-red-500",children:t.billdate})]})]}),(0,n.jsxs)("div",{className:"form-inline flex relative mb-4 justify-between",children:[(0,n.jsx)("div",{className:"w-[25%] font-semibold",children:"Productname"}),(0,n.jsx)("div",{className:"w-[25%] font-semibold",children:"Quantity"}),(0,n.jsx)("div",{className:"w-[25%] font-semibold",children:"Rate per"}),(0,n.jsx)("div",{className:"w-[25%] font-semibold",children:"Amount"})]}),(0,n.jsxs)("div",{className:"mt-3 w-[100%]",children:[V.map(((e,a)=>{var r,l;return(0,n.jsxs)("div",{className:" ",children:[a===P&&e.quantity&&z&&(0,n.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-gray-500 bg-opacity-50 backdrop-blur-md z-30",children:(0,n.jsxs)("div",{className:"bg-white border-gray-500 p-4 border-[1px] rounded-md shadow-lg z-40 relative",children:[(0,n.jsx)("input",{type:"text",onChange:e=>{((e,t)=>{const{name:a,value:s}=e.target;v({...N,[t]:s})})(e,a)},onKeyPress:e=>{((e,t)=>{"Enter"===e.key&&(e.preventDefault(),f(0,t))})(e,a)},value:N[a]||"",name:"serialNumbers",placeholder:"Enter serial number...",className:" px-3 py-1 border-black border-[2px] rounded-md"}),(0,n.jsx)("button",{type:"button",onClick:e=>f(0,a),children:"Add Serial"}),(null===e||void 0===e||null===(r=e.serialNumbers)||void 0===r?void 0:r.length)>0&&(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("h2",{className:"font-bold",children:"Serial Numbers:"}),(0,n.jsx)("ul",{className:"grid gap-2 w-[50%] mt-2",children:null===e||void 0===e||null===(l=e.serialNumbers)||void 0===l?void 0:l.map(((e,t)=>(0,n.jsxs)("li",{className:"flex gap-2 border-gray-400 border-[1px] rounded-md px-2 items-center justify-between",children:[e,(0,n.jsx)("button",{onClick:()=>(e=>{const t=[...V],a=t[P].serialNumbers;t[P].serialNumbers=a.filter((t=>t!==e)),B(t)})(e),className:"text-red-500",children:"x"})]},t)))})]})]})}),(0,n.jsxs)("div",{className:"form-inline flex relative  justify-between",onFocus:()=>D(a),children:[(0,n.jsxs)("div",{className:"inline-block w-[25%]",children:[(0,n.jsx)("input",{type:"text",className:"w-[100%]",onFocus:()=>F(a),name:"productname",value:e.productname||"",onChange:e=>R(a,e),placeholder:"Product"}),t[`productname_${a}`]&&(0,n.jsx)("span",{className:"text-red-500",children:t[`productname_${a}`]}),I===a&&L&&(0,n.jsx)("div",{className:"absolute bg-gray-300 px-3  rounded-md",children:(0,n.jsx)("div",{className:"suggestions",children:L.map(((e,t)=>(0,n.jsx)("div",{className:"suggestion cursor-pointer",onClick:()=>(async(e,t)=>{try{var a,r,l,n,i,o;let u=localStorage.getItem("token");const c=await s.A.get(`${d}/api/product/fetchsingleproduct/${e}`,{method:"GET",headers:{authtoken:u}});T(null===c||void 0===c||null===(a=c.data)||void 0===a||null===(r=a.othername1)||void 0===r?void 0:r.Serialrequired);const m=[...V];m[t].productname=null===c||void 0===c||null===(l=c.data)||void 0===l||null===(n=l.othername1)||void 0===n?void 0:n.name,m[t].productid=null===c||void 0===c||null===(i=c.data)||void 0===i||null===(o=i.othername1)||void 0===o?void 0:o._id,B(m),E([])}catch(u){console.error("Error fetching products:",u)}})(e,a),children:e},t)))})})]}),(0,n.jsxs)("div",{className:"w-[25%] flex flex-col",children:[(0,n.jsx)("input",{type:"number",name:"quantity",onChange:e=>R(a,e),value:e.quantity,className:"px-3 py-1    rounded-md"}),t[`quantity_${a}`]&&(0,n.jsx)("span",{className:"text-red-500",children:t[`quantity_${a}`]})]}),(0,n.jsxs)("div",{className:"w-[25%]  flex flex-col",children:[(0,n.jsx)("input",{type:"number",name:"rateper",onChange:e=>R(a,e),value:e.rateper,className:"px-3 py-1   w- rounded-md"}),t[`rateper_${a}`]&&(0,n.jsx)("span",{className:"text-red-500",children:t[`rateper_${a}`]})]}),(0,n.jsxs)("div",{className:"w-[25%]  flex flex-col",children:[(0,n.jsx)("input",{type:"number",name:"amount",onChange:e=>R(a,e),value:e.amount,className:"px-3 py-1   rounded-md"}),t[`amount_${a}`]&&(0,n.jsx)("span",{className:"text-red-500",children:t[`amount_${a}`]})]}),a?(0,n.jsx)("button",{className:"absolute bg-white border-[1px] border-gray-400 rounded-md text-[12px] text-red-500 right-0",type:"button",onClick:()=>(e=>{const t=[...V];t.splice(e,1),B(t)})(a),children:"Remove"}):null]},a)]})})),(0,n.jsx)("button",{type:"button",onClick:()=>{B([...V,{quantity:"",amount:"",productname:"",serialNumbers:[],serialInput:"",rateper:""}])},children:"Add More"})]}),(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsx)("div",{className:"bg-blue-600 text-white py-1 px-3 rounded-md cursor-pointer",onClick:()=>{(async()=>{const e={};if(S||(e.supplierquery="Supplier is required"),i.billdate||(e.billdate="Bill date is required"),i.billno||(e.billno="Bill number is required"),V.forEach(((t,a)=>{t.productname||(e[`productname_${a}`]="Product name is required"),(!t.quantity||isNaN(t.quantity)||t.quantity<=0)&&(e[`quantity_${a}`]="Valid quantity is required"),(!t.rateper||isNaN(t.rateper)||t.rateper<=0)&&(e[`rateper_${a}`]="Valid rate per is required"),(!t.amount||isNaN(t.amount)||t.amount<=0)&&(e[`amount_${a}`]="Valid amount is required")})),Object.keys(e).length)a(e);else try{const{billdate:e,billno:t}=i,a=e.toString(),r=t.toString(),l=localStorage.getItem("token"),u=await s.A.post(`${d}/api/purchase/addpurchase`,{productname:V,billdate:a,billno:r,supplier:S},{headers:{authtoken:l}});u.data.success?(c((0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"text-green-600 font-semibold text-lg mb-2",children:u.data.message}),(0,n.jsx)("div",{className:"relative w-full h-2 rounded-full overflow-hidden bg-green-200 mt-4",children:(0,n.jsx)("div",{className:"absolute top-0 left-0 h-full bg-green-500 animate-progress-bar2",style:{animationDuration:"0.5s"}})})]})),h(),B([{quantity:"",amount:"",productname:"",serialNumbers:[],serialInput:"",rateper:""}]),o({billdate:"",billno:""}),$("")):(c((0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"text-red-600 font-semibold text-lg mb-2",children:u.data.message}),(0,n.jsx)("div",{className:"relative w-full h-2 rounded-full overflow-hidden bg-red-200 mt-4",children:(0,n.jsx)("div",{className:"absolute top-0 left-0 h-full bg-red-500 animate-progress-bar2",style:{animationDuration:"0.5s"}})})]})),h())}catch(t){console.error("Error:",t),c((0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"text-red-600 font-semibold text-lg mb-2",children:"An error occurred. Please try again."}),(0,n.jsx)("div",{className:"relative w-full h-2 rounded-full overflow-hidden bg-red-200 mt-4",children:(0,n.jsx)("div",{className:"absolute top-0 left-0 h-full bg-red-500 animate-progress-bar2",style:{animationDuration:"0.5s"}})})]}))}})()},children:"Add Purchase"})})]})})}}}]);
//# sourceMappingURL=318.9a90767f.chunk.js.map